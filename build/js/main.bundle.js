(()=>{"use strict";const e=(e,t)=>t[e%100>4&&e%100<20?2:[2,0,1,1,1,2][e%10<5?e%10:5]],t=e=>"Escape"===e.key||"Esc"===e.key,r=document.querySelector("#error").content.querySelector(".error"),o=document.querySelector("#success").content.querySelector(".success"),n=r.cloneNode("true"),a=n.querySelector(".error__button"),c=o.cloneNode("true"),s=e=>{const r=e=>{t(e)&&(e.preventDefault(),n.remove(),document.removeEventListener("keydown",r))},o=e=>{(e=>"Enter"===e.key)(e)&&(e.preventDefault(),n.remove(),document.removeEventListener("keydown",o))};document.body.append(n),n.querySelector("p").textContent=e,document.addEventListener("keydown",r),n.addEventListener("click",(()=>{n.remove()})),a.addEventListener("keydown",o)},u=(e,t)=>{fetch("https://22.javascript.pages.academy/keksobooking/data").then((e=>{if(e.ok)return e.json();t(`${e.status}: ${e.statusText}`)})).then((t=>{e(t)})).catch((()=>t("Не удалось получить данные.")))},d=document.querySelector(".ad-form-header__input"),i=document.querySelector(".ad-form-header__preview img"),l=document.querySelector(".ad-form__input"),p=document.querySelector(".ad-form__photo"),m=["gif","jpg","jpeg","png"];d.addEventListener("change",(()=>{const e=d.files[0],t=e.name.toLowerCase();if(m.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(()=>{i.src=t.result})),t.readAsDataURL(e)}})),l.addEventListener("change",(()=>{const e=l.files[0],t=e.name.toLowerCase();if(m.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(()=>{p.innerHTML="";const e=p.appendChild(document.createElement("img"));e.width=p.offsetWidth,e.height=p.offsetHeight,e.src=t.result})),t.readAsDataURL(e)}}));const f=()=>{i.src="img/muffin-grey.svg",p.innerHTML=""},y={bungalow:0,flat:1e3,house:5e3,palace:1e4},v={1:[1],2:[1,2],3:[1,2,3],100:[0]},h=document.querySelector("#type"),g=document.querySelector("#price"),S=document.querySelector(".ad-form__element--time"),q=document.querySelector("#timein"),E=document.querySelector("#timeout"),b=document.querySelector(".ad-form"),k=document.querySelector(".map__filters"),w=document.querySelectorAll("fieldset"),C=document.querySelectorAll(".map__filter"),x=document.querySelector("#address"),$=document.querySelector("#title"),A=document.querySelector("#room_number"),V=document.querySelector("#capacity").querySelectorAll("option"),T=b.querySelector(".ad-form__reset"),D=()=>{const e=y[h.value];g.setAttribute("placeholder",e),g.setAttribute("min",e)};h.addEventListener("change",D),S.addEventListener("change",(e=>{q.value=e.target.value,E.value=e.target.value})),$.addEventListener("input",(()=>{const e=$.value.length;e<30?$.setCustomValidity("Ещё "+(30-e)+" симв."):e>100?$.setCustomValidity("Удалите лишние "+(e-100)+" симв."):$.setCustomValidity(""),$.reportValidity()})),g.addEventListener("input",(()=>{const e=g.value;e<y[h.value]?g.setCustomValidity(`Минимальная цена - ${y[h.value]}`):e>1e6?g.setCustomValidity("Максимальная цена - 1000000"):g.setCustomValidity(""),g.reportValidity()}));const z=()=>{V.forEach((e=>{v[A.value].includes(Number(e.value))?(e.disabled=!1,e.selected=!0):e.disabled=!0}))};A.addEventListener("change",z),T.addEventListener("click",(e=>{e.preventDefault(),b.reset(),k.reset(),D(),z(),ee(),f(),u((e=>{re(e)}),s)}));const N=()=>{(e=>{const r=e=>{t(e)&&(e.preventDefault(),c.remove(),document.removeEventListener("keydown",r))};document.body.append(c),c.querySelector("p").textContent="Форма отправлена!",document.addEventListener("keydown",r),c.addEventListener("click",(()=>{c.remove()}))})(),b.reset(),k.reset(),D(),z(),ee(),f(),u((e=>{re(e)}),s)},j=()=>{s("Не удалось отправить форму. Попробуйте ещё раз.")},F={flat:"Квартира",bungalow:"Бунгало",house:"Дом",palace:"Дворец"},H=["комната","комнаты","комнат"],M=["гостя","гостей","гостей"],R=document.querySelector("#card").content.querySelector(".popup"),U=k.querySelector("#housing-type"),W=k.querySelector("#housing-price"),O=k.querySelector("#housing-rooms"),P=k.querySelector("#housing-guests"),I=k.querySelector("#housing-features"),B=e=>(e=>"any"===U.value||e.offer.type===U.value)(e)&&(e=>{switch(W.value){case"any":return!0;case"low":return e.offer.price<1e4;case"middle":return e.offer.price>=1e4&&e.offer.price<5e4;case"high":return e.offer.price>=5e4;default:return!1}})(e)&&(e=>"any"===O.value||e.offer.rooms===Number(O.value))(e)&&(e=>"any"===P.value||e.offer.guests===Number(P.value))(e)&&(e=>{const t=[...I.querySelectorAll("input:checked")].map((e=>e.value));return!t.length||t.every((t=>e.offer.features.includes(t)))})(e),G={lat:35.6895,lng:139.69171},J={url:"../img/main-pin.svg",size:[52,52],anchor:[26,52]},K={url:"../img/pin.svg",size:[40,40],anchor:[20,40]};let Q=[];w.forEach((e=>{e.disabled=!0})),C.forEach((e=>{e.disabled=!0})),b.classList.add("ad-form--disabled"),k.classList.add("map__filters--disabled");const X=L.map("map-canvas").on("load",(()=>{w.forEach((e=>{e.disabled=!1})),C.forEach((e=>{e.disabled=!1})),b.classList.remove("ad-form--disabled"),k.classList.remove("map__filters--disabled"),z()})).setView(G,13);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(X);const Y=L.icon({iconUrl:J.url,iconSize:J.size,iconAnchor:J.anchor}),Z=e=>{x.value=`${e.lat.toFixed(5)}, ${e.lng.toFixed(5)}`},ee=()=>{te.setLatLng(G),Z(G)};x.setAttribute("readonly",!0),Z(G);const te=L.marker(G,{draggable:!0,icon:Y});te.on("move",(()=>{const e=te.getLatLng();Z(e)})).addTo(X);const re=t=>{Q.forEach((e=>{e.remove()})),t.slice(0,10).filter(B).forEach((t=>{const r=L.icon({iconUrl:K.url,iconSize:K.size,iconAnchor:K.anchor}),o=L.marker({lat:t.location.lat,lng:t.location.lng},{icon:r});o.addTo(X).bindPopup((t=>{const r=R.cloneNode("true");var o,n;return r.querySelector(".popup__title").textContent=t.offer.title,r.querySelector(".popup__text--address").textContent=t.offer.address,r.querySelector(".popup__text--price").textContent=`${t.offer.price} ₽/ночь`,r.querySelector(".popup__type").textContent=F[t.offer.type],r.querySelector(".popup__text--capacity").textContent=`${t.offer.rooms} ${e(t.offer.rooms,H)} для ${t.offer.guests} ${e(t.offer.guests,M)}`,r.querySelector(".popup__text--time").textContent=`Заезд после ${t.offer.checkin}, выезд до ${t.offer.checkout}`,r.querySelector(".popup__description").textContent=t.offer.description,r.querySelector(".popup__avatar").src=t.author.avatar,o=r.querySelector(".popup__features"),n=t.offer.features,o.innerHTML="",n.forEach((e=>{const t=document.createElement("li");t.classList.add("popup__feature",`popup__feature--${e}`),o.appendChild(t)})),((e,t)=>{const r=e.querySelector(".popup__photo");e.innerHTML="",t.forEach((t=>{const o=r.cloneNode("true");o.src=t,e.appendChild(o)}))})(r.querySelector(".popup__photos"),t.offer.photos),r})(t),{keepInView:!0}),Q.push(o)}))};u((e=>{var t;re(e),t=_.debounce((()=>re(e)),500),k.addEventListener("change",t)}),s),b.addEventListener("submit",(e=>{var t,r,o;e.preventDefault(),t=N,r=j,o=new FormData(e.target),fetch("https://22.javascript.pages.academy/keksobooking",{method:"POST",body:o}).then((e=>{e.ok?t():r()})).catch((()=>{r()}))}))})();
//# sourceMappingURL=main.bundle.js.map